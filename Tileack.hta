<!DOCTYPE html>

<meta charset="ISO-8859-1" /> 
<meta http-equiv="X-UA-Compatible" content="IE=edge" />

<HTA:APPLICATION 
    ID='ListTxtCmd'
    Scroll='Yes'
    SingleInstance='No'
    SysMenu='Yes'
    ShowInTaskBar='No'
    MaximizeButton='Yes'
    MinimizeButton='Yes'
    Border='None'
    INNERBORDER ='No'
    Caption='No'

	showintaskbar="yes"

    WindowState='Normal'
    APPLICATIONNAME='Tileack'
    Icon='%SystemRoot%\explorer.exe'
>

<title>Tileack</title>

<style>
    html, body, div, p, a, li, ul, span, input {
        font-family: "Segoe UI";
        font-weight: 400;
    }

    html, body, div, p, a, li, ul, span {
        color: #fff;
    }
    input {
        color: #111;
    }

    html, body {
        min-width: 100%;
        min-height: 100%;
        margin: 0;
        padding: 0;
        max-height: 100%;
        height: 100%;

        background: #333;
    }

    html {
        max-width: 100%;
    }

    body {
        overflow: scroll;

        overflow-x: scroll;
        overflow-y: hidden;
        white-space: nowrap;

        vertical-align: top;
    }

    .explorer {
        vertical-align: top;
        position: relative;
        display: inline-block;

        min-width: 100px;
        min-height: 100%;
        height: 100%;

        padding: 44px 0 6px 0;

        -moz-box-sizing: border-box;
        box-sizing: border-box;
        margin-right: 2px;

        box-shadow: inset 1px 4px 9px -6px; 
        border-right: 1px solid #262626;
    }
        .explorer-bar {
            position: absolute;
            left: 0;
            top: 0;
            right: 0;
            height: 32px;

            width: 100%;

            margin: 0;
            border: 0 none;

            font-size: 21px;

            padding: 6px 0;

            border-bottom: 1px solid #ddd;
        }
        .explorer-content {
            width: 100%;
            height: 100%;

            min-width: 100%;
            min-height: 100%;

            max-width: 100%;
            max-height: 100%;
        }
            .explorer-scroll {
                min-width: 100%;
                width: 100%;
                min-height: 100%;
                height: 100%;

                overflow: hidden;
                overflow-x: hidden;
                overflow-y: auto;

                white-space: nowrap;
            }
                .explorer-info {
                    width: 100%;
                    -moz-box-sizing: border-box;
                    box-sizing: border-box;

                    margin-top: 9px;
                    margin-bottom: 24px;

                    font-size: 21px;

                    background: #222;
                    padding: 0 32px 6px 6px;
                }
                    .explorer-info-controls {
                        width: 100%;
                    }
                        .explorer-info-control {
                            display: inline;

                            vertical-align: middle;

                            height: 32px;
                            width: 32px;

                            margin-right: 4px;

                            border: 1px solid transparent;
                            border-radius: 5px;

                            padding: 0 4px 1px 4px;

                            font-size: 12px;
                        }
                        .explorer-info-control:hover {
                            border: 1px solid #666;
                        }

                .explorer-file,
                .explorer-folder {
                    display: block;

                    min-width: 100%;
                    width: 100%;
                    max-width: 100%;

                    padding: 3px 18px;
                    font-size: 18px;

                    -moz-box-sizing: border-box;
                    box-sizing: border-box;
                }
                .explorer-file,
                .explorer-info-control,
                .explorer-folder,
                .explorer-file:active,
                .explorer-info-control:active,
                .explorer-folder:active,
                .explorer-file:hover,
                .explorer-info-control:hover,
                .explorer-folder:hover {
                    text-decoration: none;
                }

                .explorer-file:hover,
                .explorer-folder:hover {
                    background: #555;
                }

                .explorer-folder.first {
                    margin-top: 32px;
                }
</style>

<body></body>

<script>
    var FILE_SYSTEM = new ActiveXObject("Scripting.FileSystemObject");
    var SHELL = new ActiveXObject("Shell.Application");

    var colours = {
            'php'   : '#e02366',
            'rb'    : '#e02366',

            'js'    : '#00A3DC',

            'html'  : '#00A971',
            'hta'   : '#00A971',

            'css'   : '#dd5e1d',

            'vimrc' : '#875FAB'
    };
    
    function getExtensionColour(name) {
        var parts = name.split('.');
        var extension = parts[parts.length-1];

        return colours[extension];
    }

    function getParts(str, seperator, index, len) {
        if ( typeof str !== 'string' ) {
            str += "";
        }

        if ( len === undefined ) {
            len = 1;
        }

        var parts = str.split( seperator );
        var r = '';

        if ( index < 0 ) {
            index = Math.max( 0, parts.length + index );
        }

        var end = Math.min( parts.length, index+len );

        for ( var i = index; i < end; i++ ) {
            if ( i !== index ) {
                r += seperator;
            }

            r += parts[i];
        }

        return r;
    }

    function newExplorer(defaultUrl) {
        var div = el('div', 'explorer');
        var scroll = el('div', 'explorer-scroll');
        var content = el('div', 'explorer-content');
        var top = el('input', 'explorer-bar', {
                type: 'text',
                keyup: function(ev) {
                    if ( ev.keyCode !== 27 ) {
                        var folder = top.value;

                        moveExplorer( scroll, top, folder );
                    }
                }
        });

        div.appendChild( top );
        div.appendChild( content );
        content.appendChild( scroll );

        if ( defaultUrl ) {
            moveExplorer( scroll, top, defaultUrl );
        }

        document.body.appendChild( div );
    }

    function newAnchor( name, className, action ) {
        return el( 'a', className, { text: name, click: action } );
    }

    function runFile( app, path ) {
        run( app, path.replace(/ /g, "\\ ") );
    }

    function run( app, args ) {
        SHELL.ShellExecute( app, args, "", "open", 1 );
    }

    function el( type ) {
        var node = document.createElement(type);

        if ( type === 'a' ) {
            node.setAttribute( 'href', '#' );
        }

        for ( var i = 1; i < arguments.length; i++ ) {
            var arg = arguments[i];

            if ( typeof arg === 'string' ) {
                if ( node.className === '' || node.className === undefined ) {
                    node.className = arg;
                } else {
                    node.className += ' ' + arg;
                }
            } else {
                for ( var key in arg  ) {
                    var val = arg[key];

                    var k = key.toLowerCase();

                    if (
                            k === 'click' ||
                            k === 'keyup' ||
                            k === 'keydown' ||
                            k === 'keypress' ||
                            k === 'load' ||
                            k === 'mousedown' ||
                            k === 'mousemove' ||
                            k === 'mouveup' ||
                            k === 'mouseclick'
                    ) {
                        node.addEventListener( key, val );
                    } else if ( 
                            k === 'html' ||
                            k === 'innerhtml'
                    ) {
                        node.innerHTML = val;
                    } else if (
                            k === 'text' ||
                            k === 'textcontent'
                    ) {
                        node.textContent = val;
                    } else {
                        node.setAttribute( key, arg );
                    }
                }
            }
        }

        return node;
    }

    function newInfoBar( folder, content ) {
        var parts = folder.split("\\");

        var info = el('div', 'explorer-info');

        info.textContent = getParts( folder, "\\", -3, 2 );

        parts.splice( parts.length-2, 2 );
        var subFolder = parts.join( "\\" ) + "\\";

        var controls = el('div', 'explorer-info-controls');

        // the buttons
        controls.appendChild( newAnchor('folder', 'explorer-info-control open-explorer', function() {
            runFile( 'explorer', folder );
        } ));
        controls.appendChild( newAnchor('cmd', 'explorer-info-control open-powershell', function() {
            runFile( 'powershell', folder );
        } ));

        controls.appendChild( newAnchor('..', 'explorer-info-control open-upfolder', function() {
            moveExplorer( content, top, subFolder );
        } ));

        info.appendChild( controls );
        content.appendChild( info );

        return info;
    }

    function moveExplorer( content, top, folder ) {
        folder = (folder+"").replace( /\//g, "\\" );
        if ( folder.charAt(folder.length-1) !== "\\" ) {
            folder += "\\";
        }

        if ( FILE_SYSTEM.FolderExists(folder) ) {
            var folders = [];

            content.innerHTML = '';
            var folderObjs = FILE_SYSTEM.GetFolder(folder);
            var en;

            content.appendChild( newInfoBar(folder, content) );

            en = new Enumerator(folderObjs.Files);
            for (;!en.atEnd(); en.moveNext()) {
                (function(path) {
                    path += "";

                    var parts = path.split("\\");
                    var name = parts[ parts.length-1 ] || path;

                    var fileLink = newAnchor(name, 'explorer-file', function() {
                        runFile( 'explorer', path );
                    });
                    var fileLink = newAnchor(name, 'explorer-file', function() {
                        runFile( 'explorer', path );
                    });

                    var colour = getExtensionColour( name );
                    if ( colour ) {
                        fileLink.style.background = colour;
                    }
                    
                    content.appendChild( fileLink );
                })(en.item());
            }

            en = new Enumerator(folderObjs.SubFolders);
            var isFirst = ' first';
            for (;!en.atEnd(); en.moveNext()) {
                (function(path) {
                    path += "";

                    var parts = path.split("\\");
                    var name = parts[ parts.length-1 ] || path;

                    content.appendChild( newAnchor(name, 'explorer-folder' + isFirst, function() {
                        moveExplorer( content, top, path );
                    } ));
                })(en.item());

                isFirst = '';
            }

            top.value = folder;
        }
    }
</script>

<script>
    // start her up!
    window.onload = function() {
        numExplorer = 5;

        for ( var i = 0; i < numExplorer; i++ ) {
            newExplorer("c:\\users\\joseph\\projects");
        }

        document.addEventListener('keyup', function(ev) {
            if ( ev.keyCode === 27 ) {
                window.close();
            }
        } );
    };
</script>
